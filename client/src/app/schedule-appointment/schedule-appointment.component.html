
<app-dashbaord></app-dashbaord>
 
<div class="schedule-page-container">
 
  <div class="card shadow-lg schedule-card">
    <div class="card-body p-4 p-md-5">
 
      <div class="schedule-card-header">
        <h4 class="mb-0 d-flex align-items-center justify-content-center">
          <i class="bi bi-calendar-plus me-2"></i>
          Schedule Appointment
        </h4>
      </div>
 
      <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
 
        <div class="mb-3">
          <label for="doctorId" class="form-label fw-semibold">Select Doctor</label>
          <select 
            id="doctorId" 
            class="form-select" 
            formControlName="doctorId"
            [ngClass]="{'is-invalid': f['doctorId'].invalid && f['doctorId'].touched}">
            <option value="">-- Choose Doctor --</option>
            <option *ngFor="let doctor of availableDoctors" [value]="doctor.id">
              {{ doctor.username }} ({{ doctor.specialty }})
            </option>
          </select>
          <div *ngIf="f['doctorId'].invalid && f['doctorId'].touched" class="invalid-feedback">
            <small *ngIf="f['doctorId'].errors?.['required']">Doctor selection is required.</small>
          </div>
        </div>
 
        <div class="mb-3">
          <label for="patientId" class="form-label fw-semibold">Patient ID</label>
          <input id="patientId" class="form-control" formControlName="patientId" readonly />
        </div>
 
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="appointmentDate" class="form-label fw-semibold">Date</label>
            <input 
              id="appointmentDate" 
              type="date" 
              class="form-control" 
              formControlName="appointmentDate"
              [attr.min]="today"
              [ngClass]="{'is-invalid': f['appointmentDate'].invalid && f['appointmentDate'].touched}" />
            <div *ngIf="f['appointmentDate'].invalid && f['appointmentDate'].touched" class="invalid-feedback">
              <small *ngIf="f['appointmentDate'].errors?.['required']">Date is required.</small>
            </div>
          </div>
 
          <div class="col-md-6 mt-3 mt-md-0">
            <label for="time" class="form-label fw-semibold">Time</label>
            <input 
              id="time" 
              type="time" 
              class="form-control" 
              formControlName="time"
              [disabled]="!f['appointmentDate'].value"
              [attr.min]="f['appointmentDate'].value === today ? currentTime : null"
              [ngClass]="{'is-invalid': f['time'].invalid && f['time'].touched}" />
            <div *ngIf="f['time'].invalid && f['time'].touched" class="invalid-feedback">
              <small *ngIf="f['time'].errors?.['required']">Time is required.</small>
            </div>
          </div>
        </div>
 
        <div class="mb-3">
          <label for="reason" class="form-label fw-semibold">Reason</label>
          <textarea 
            id="reason" 
            class="form-control" 
            rows="3" 
            formControlName="reason"
            placeholder="Enter reason for appointment"
            [ngClass]="{'is-invalid': f['reason'].invalid && f['reason'].touched}"></textarea>
          <div *ngIf="f['reason'].invalid && f['reason'].touched" class="invalid-feedback">
            <small *ngIf="f['reason'].errors?.['minlength']">Must be at least 7 characters.</small>
          </div>
        </div>
 
        <div *ngIf="itemForm.errors?.['pastDateTime']" class="alert alert-danger d-flex align-items-center">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div>Cannot select a past date and time.</div>
        </div>
 
        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-primary btn-lg" [disabled]="itemForm.invalid">
            <i class="bi bi-calendar-plus-fill me-2"></i> Schedule
          </button>
        </div>
 
      </form>

      <div *ngIf="successMessage" class="alert alert-success d-flex align-items-center">
          <i class="bi bi-check-circle-fill me-2"></i>
          <div>{{ successMessage }}</div>
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div>{{ errorMessage }}</div>
        </div>
    </div>
  </div>
</div>
 